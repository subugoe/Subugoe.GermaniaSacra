// Generated by CoffeeScript 1.7.1
var init, s_loading;

germaniaSacra.controller('listController', function($scope) {
  $scope.$watch((function() {
    return $('#list').data('type');
  }), (function(newval, oldval) {
    if (newval != null) {
      return init();
    }
  }), true);
  return $scope.$on('$locationChangeStart', function(e) {
    if ($('.dirty').length) {
      if (confirmDiscardChanges()) {
        return $('.dirty').removeClass('dirty');
      } else {
        return e.preventDefault();
      }
    }
  });
});

s_loading = '<i class="spinner spinner-icon"></i> Wird geladen&hellip;';

init = function() {
  var $saveButton, type;
  type = $('#list').data('type');
  $('#message').hide();
  $saveButton = $('<button/>', {
    disabled: 'disabled',
    type: 'submit',
    html: '<i class="icon-disk"></i> Änderungen speichern'
  });
  $('#edit form, #list form').append($saveButton).append($('#csrf').clone().removeAttr('id'));
  initSearch();
  initList(type);
  initEditor(type);
  $("fieldset .multiple").append("<div class='add-remove-buttons'><button class='remove'>-</button><button class='add'>+</button></div>");
  $("fieldset .multiple button").click(function(e) {
    var div;
    e.preventDefault();
    div = $(this).closest(".multiple");
    if ($(this).hasClass("remove")) {
      return div.removeInputs(250);
    } else if ($(this).hasClass("add")) {
      return div.addInputs(250);
    }
  });
  $(".new").click(function(e) {
    e.preventDefault();
    return newAction();
  });
  $(window).bind("keydown", function(e) {
    if (e.ctrlKey || e.metaKey) {
      switch (String.fromCharCode(e.which).toLowerCase()) {
        case "a":
          e.preventDefault();
          return $("button.new:visible:last").click();
        case "s":
          e.preventDefault();
          return $(":submit[type=submit]:visible:last").click();
      }
    }
  });
  $(".togglable + .togglable").hide();
  $(".toggle").click(function(e) {
    e.preventDefault();
    return $(this).closest(".togglable").siblings(".togglable").addBack().slideToggle();
  });
  return window.onbeforeunload = function() {
    if ($('.dirty').length) {
      return 'Sind Sie sicher, dass Sie diese Seite verlassen wollen? Ihre Änderungen wurden nicht gespeichert.';
    }
  };
};
