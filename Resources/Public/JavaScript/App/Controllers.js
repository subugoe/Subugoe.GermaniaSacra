// Generated by CoffeeScript 1.7.1
var init, s_loading, selectOptions;

germaniaSacra.controller('listController', function($scope) {
  $scope.$watch((function() {
    return $('#list').data('type');
  }), (function(newval, oldval) {
    if (newval != null) {
      return init();
    }
  }), true);
  return $scope.$on('$locationChangeStart', function(e) {
    if ($('.dirty').length) {
      if (confirmDiscardChanges()) {
        return $('.dirty').removeClass('dirty');
      } else {
        return e.preventDefault();
      }
    }
  });
});

s_loading = '<i class="spinner spinner-icon"></i> Wird geladen&hellip;';

selectOptions = {};

init = function() {
  var $saveButton, type;
  type = $('#list').data('type');
  $('#message, #search, #list').hide();
  $saveButton = $('<button/>', {
    disabled: 'disabled',
    type: 'submit',
    html: '<i class="icon-disk"></i> Änderungen speichern'
  });
  $('#edit form, #list form').append($saveButton).append($('#csrf').clone().removeAttr('id'));
  initSearch();
  initEditor(type);
  $.getJSON('getOptions', function(response) {
    $.each(response, function(name, values) {
      var $selects;
      $selects = $("#edit select[name='" + name + "'], select[name='" + name + "[]'], select[name='" + name + "_uid']");
      $selects.empty();
      return $.each(values, function(uUID, text) {
        return $selects.append($('<option/>', {
          value: uUID,
          text: text
        }));
      });
    });
    selectOptions = response;
    return initList(type);
  });
  $("fieldset .multiple").append("<div class='add-remove-buttons'><span class='button remove'>-</span><span class='button add'>+</span></div>");
  $("fieldset .multiple .button").click(function(e) {
    var div;
    e.preventDefault();
    div = $(this).closest(".multiple");
    if ($(this).hasClass("remove")) {
      return div.removeInputs(250);
    } else if ($(this).hasClass("add")) {
      return div.addInputs(250);
    }
  });
  $(".new").click(function(e) {
    e.preventDefault();
    return newAction();
  });
  $(window).bind("keydown", function(e) {
    if (e.ctrlKey || e.metaKey) {
      switch (String.fromCharCode(e.which).toLowerCase()) {
        case "a":
          e.preventDefault();
          return $("button.new:visible:last").click();
        case "s":
          e.preventDefault();
          return $(":submit[type=submit]:visible:last").click();
      }
    }
  });
  $(".togglable + .togglable").hide();
  $(".toggle").click(function(e) {
    e.preventDefault();
    return $(this).closest(".togglable").siblings(".togglable").addBack().slideToggle();
  });
  return window.onbeforeunload = function() {
    if ($('.dirty').length) {
      return 'Sind Sie sicher, dass Sie diese Seite verlassen wollen? Ihre Änderungen wurden nicht gespeichert.';
    }
  };
};
