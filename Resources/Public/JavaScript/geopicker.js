// Generated by CoffeeScript 1.7.1
var initGeopicker;

initGeopicker = function() {
  return $(".coordinates :input").focus(function() {
    var $container, baseMaps, geoJsonFile, greenIcon, lat, layers, lng, map, marker, onMapClick, overlayMaps, resourcePath;
    $container = $(this).closest(".coordinates");
    if ($container.find("#map").length > 0) {
      return false;
    }
    $('<div id="map-container"><button class="close">&times;</button></div>').css({
      width: $container.width()
    }).appendTo($container);
    $("#map-container").prepend($("<div id=\"map\"></div>").css({
      width: $container.width()
    })).slideDown();
    $("#map-container .close").hide().click(function(e) {
      e.preventDefault();
      return $("#map-container").slideUp(null, function() {
        return $(this).remove();
      });
    });
    $("html").click(function() {
      return $("#map-container .close").click();
    });
    $(".coordinates").click(function(event) {
      return event.stopPropagation();
    });
    layers = [];
    layers.osm = L.tileLayer("http://{s}.tile.osm.org/{z}/{x}/{y}.png", {
      attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'
    });
    layers.esri = L.tileLayer("http://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}", {
      attribution: "Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community"
    });
    layers.thunderforest = L.tileLayer("http://{s}.tile.thunderforest.com/landscape/{z}/{x}/{y}.png", {
      attribution: '&copy; <a href="http://www.opencyclemap.org">OpenCycleMap</a>, &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>'
    });
    layers.mapbox = L.tileLayer("https://{s}.tiles.mapbox.com/v3/{id}/{z}/{x}/{y}.png", {
      maxZoom: 18,
      attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="http://mapbox.com">Mapbox</a>',
      id: "examples.map-i86knfo3"
    });
    baseMaps = {
      OpenStreetMap: layers.osm,
      "ESRI World Imagery": layers.esri,
      "Thunderforest Landscape": layers.thunderforest,
      Mapbox: layers.mapbox
    };
    overlayMaps = {};
    map = L.map("map", {
      center: [51.163, 10.448],
      zoom: 6,
      maxZoom: 19,
      layers: layers
    });
    L.control.layers(baseMaps, overlayMaps).addTo(map);
    L.control.scale().addTo(map);
    map.invalidateSize();
    resourcePath = '_Resources/Static/Packages/Subugoe.GermaniaSacra/';
    greenIcon = L.icon({
      iconUrl: resourcePath + 'Images/marker-icon.png',
      shadowUrl: resourcePath + 'Images/marker-shadow.png',
      iconAnchor: [13, 41]
    });
    lat = $('input[name$="breite[]"]').val() || 0;
    lng = $('input[name$="laenge[]"]').val() || 0;
    marker = L.marker([lat, lng], {
      icon: greenIcon
    }).addTo(map);
    geoJsonFile = "/subugoe.germaniasacra/proxy/geojson";
    $.getJSON(geoJsonFile).success(function(data) {
      var borders, style;
      style = {
        clickable: false,
        color: "#000",
        fillColor: "#000",
        weight: 1.5,
        opacity: 0.3,
        fillOpacity: 0.05
      };
      borders = L.geoJson(data, {
        style: style
      });
      return borders.addTo(map);
    });
    $("#map .leaflet-control-layers-base input:eq(0)").click();
    return map.on("click", onMapClick = function(e) {
      var cnfrm;
      lat = e.latlng.lat.toFixed(6);
      lng = e.latlng.lng.toFixed(6);
      cnfrm = confirm("Sollen die Koordinaten " + lat + ", " + lng + " übernommen werden?");
      if (cnfrm === true) {
        $container.find(":input[name$=\"breite[]\"]").val(lat);
        $container.find(":input[name$=\"laenge[]\"]").val(lng);
        return marker.setLatLng(e.latlng);
      }
    });
  });
};
