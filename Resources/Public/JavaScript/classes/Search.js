// Generated by CoffeeScript 1.7.1
germaniaSacra.Search = (function() {
  function Search() {
    this.scope = $('#simple-search, #advanced-search');
    $('select', this.scope).autocomplete();
    $('#simple-search').submit(function() {
      var searchString;
      germaniaSacra.message('loading', false);
      searchString = $("[name='alle']", $(this)).val();
      return germaniaSacra.list.dataTable.search(searchString, true, false).draw();
    });
    $('#advanced-search').submit(function() {
      var json, search;
      germaniaSacra.message('loading', false);
      json = $(this).serializeArray();
      search = $.post('/search', json);
      search.success(function(data) {
        var searchString;
        data = $.parseJSON(data);
        if (data.length) {
          searchString = data.join('|');
          return germaniaSacra.list.dataTable.column(0).search(searchString, true, false).draw();
        } else {
          return germaniaSacra.list.dataTable.draw();
        }
      });
      return search.fail(function(data) {
        $('#message').slideUp();
        return alert('Suche fehlgeschlagen');
      });
    });
    $('.reset', this.scope).click(function(e) {
      germaniaSacra.message('loading', false);
      e.preventDefault();
      germaniaSacra.list.dataTable.search('').column(0).search('').draw();
      return $(this).parents('form').clearForm();
    });
  }

  return Search;

})();
