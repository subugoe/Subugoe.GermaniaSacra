// Generated by CoffeeScript 1.7.1
var createAction, deleteAction, editAction, newAction, populateSelectsAction, updateAction;

populateSelectsAction = function() {
  var url;
  url = "getOptions";
  return $.getJSON(url, function(response) {
    var options;
    options = {};
    options.bearbeitungsstatus = response[0];
    options.personallistenstatus = response[1];
    options.band = response[2];
    options.literatur = response[3];
    options.bistum = response[4];
    options.orden = response[5];
    options.klosterstatus = response[6];
    options.bearbeiter = response[7];
    options.url_typ = response[8];
    return $.each(options, function(name, values) {
      var $select;
      $select = $("#edit select[name=\"" + name + "\"], select[name=\"" + name + "[]\"]");
      $select.empty().append($("<option>", {
        value: "",
        text: ""
      }));
      return $.each(values, function(index, object) {
        return $.each(object, function(value, uuid) {
          return $select.append($("<option>", {
            value: uuid,
            text: value
          }));
        });
      });
    });
  });
};

newAction = function() {
  $("#list").slideUp();
  $("#edit").slideDown();
  $(this).clear_form();
  $(this).find(".autocomplete").autocomplete('ort');
  $(this).find("textarea").trigger("autosize.resize");
  return $(this).find("input[type=url]").keyup();
};

createAction = function(type) {
  var $this;
  $this = $(this);
  if (type === 'kloster') {
    return $.post("create", $this.serialize()).done(function(respond, status, jqXHR) {
      $.get("solrUpdateWhenKlosterCreate", {
        uuid: respond
      });
      return $this.message('Ein neuer Eintrag wurde angelegt.');
    }).fail(function(jqXHR, textStatus) {
      $this.message('Error');
      return console.dir(jqXHR.responseText);
    });
  } else {
    return $.post("create" + ucfirst(type), $this.serialize()).done(function(respond, status, jqXHR) {
      return $this.message('Ein neuer Eintrag wurde angelegt.');
    }).fail(function(jqXHR, textStatus) {
      $this.message('Error');
      return console.dir(jqXHR.responseText);
    });
  }
};

editAction = function(type, id) {
  var $this, url;
  $this = $('#edit form');
  $this.clear_form();
  $("#list").slideUp();
  $('#loading').show();
  url = type + '/edit/' + id;
  return $.getJSON(url, function(obj) {
    var $fieldset, uuid;
    if (type === 'kloster') {
      uuid = kloster.uuid;
      $this.attr('action', 'updateKloster/' + uuid);
      $fieldset = $("#klosterdaten");
      $fieldset.find("label :input").each(function() {
        var name, val;
        name = $(this).attr("name");
        if (typeof name === "undefined") {
          return name = name.replace("[]", "");
        }
        if (name === 'changeddate' || name === 'creationdate') {
          val = obj[name] ? obj[name].date.substr(0, obj[name].date.indexOf(".")) : '';
        } else {
          val = obj[name];
        }
        return $(this).val(val);
      });
      $fieldset = $("#klosterorden");
      $.each(obj.klosterorden, function(index, value) {
        if (index > 0) {
          $fieldset.find(".multiple:last()").addInputs(0);
        }
        return $fieldset.find(".multiple:last() label :input").each(function() {
          var name;
          name = $(this).attr("name");
          if (typeof name === "undefined") {
            return;
          }
          name = name.replace("[]", "");
          return $(this).val(value[name]);
        });
      });
      $fieldset = $("#klosterstandorte");
      $.each(obj.klosterstandorte, function(index, value) {
        if (index > 0) {
          $fieldset.find(".multiple:last()").addInputs(0);
        }
        return $fieldset.find(".multiple:last() label :input").each(function() {
          var checkedCondition, disabledCondition, name, text, val;
          name = $(this).attr("name");
          if (typeof name === "undefined") {
            return;
          }
          name = name.replace("[]", "");
          val = value[name];
          if (name === "wuestung") {
            if (name === "wuestung") {
              checkedCondition = value[name] === 1;
              return $(this).prop("checked", checkedCondition);
            }
          } else if (name === "ort") {
            return $(this).html($("<option />", {
              value: value["uuid"],
              text: value["ort"]
            }).attr("selected", true));
          } else if (name === "bistum") {
            $(this).val(value[name]);
            text = $(this).find(':selected');
            disabledCondition = text !== "keine Angabe" && text !== "";
            return $(this).prop("disabled", disabledCondition);
          } else {
            return $(this).val(value[name]);
          }
        });
      });
      $fieldset = $("#links");
      $.each(obj.url, function(index, value) {
        if (value.url_typ_name === "GND") {
          $(":input[name=gnd]").val(value.url);
          return $(":input[name=gnd_label]").val(value.url_label);
        } else if (value.url_typ_name === "Wikipedia") {
          $(":input[name=wikipedia]").val(value.url);
          return $(":input[name=wikipedia_label]").val(value.url_label);
        } else {
          $fieldset.find(".multiple:last()").addInputs(0);
          return $fieldset.find(".multiple:last() label :input").each(function() {
            var name;
            name = $(this).attr("name");
            if (typeof name === "undefined") {
              return;
            }
            name = name.replace("[]", "");
            return $(this).val(value[name]);
          });
        }
      });
      $fieldset.find(".multiple:eq(0)").removeInputs(0);
      $fieldset = $("#literatur");
      $.each(obj.literatur, function(index, value) {
        if (index > 0) {
          $fieldset.addInputs(0);
        }
        return $fieldset.find(".multiple:last() label :input").each(function() {
          var name;
          name = $(this).attr("name");
          if (typeof name === "undefined") {
            return;
          }
          name = name.replace("[]", "");
          return $(this).val(value);
        });
      });
    } else {
      $this.attr('action', 'update' + ucfirst(type) + '/' + uuid);
      $this.find("label :input").each(function() {
        var name, val;
        name = $(this).attr("name");
        val = obj[name];
        return $(this).val(val);
      });
    }
    $('#edit').slideDown();
    $('#loading').hide();
    $this.find(".autocomplete").autocomplete('ort');
    $this.find("input[type=url]").keyup();
    return $this.find("textarea").trigger("autosize.resize");
  });
};

updateAction = function(type) {
  var $this, url;
  $this = $(this);
  url = $this.attr("action");
  return $.post(url, $this.serialize()).done(function(respond, status, jqXHR) {
    return $.post("updateSolrAfterKlosterUpdate", {
      uuid: respond
    }).done(function(respond, status, jqXHR) {
      if (status === "success") {
        return $this.message('Ihre Änderungen wurden gespeichert.');
      }
    }).fail(function(jqXHR, textStatus) {
      $this.message('Error');
      return console.dir(jqXHR.responseText);
    });
  }).fail(function(jqXHR, textStatus) {
    $this.message('Error');
    return console.dir(jqXHR.responseText);
  });
};

deleteAction = function(type, url, csrf) {
  var $this, check;
  $this = $(this);
  check = confirm('Wollen Sie diesen Eintrag wirklich löschen?');
  if (check === true) {
    csrf = $('#csrf').val();
    return $.post(url, {
      __csrfToken: csrf
    }).done(function(respond, status, jqXHR) {
      if (status === "success") {
        return $this.message('Der Eintrag wurde gelöscht.');
      }
    }).fail(function(jqXHR, textStatus) {
      $this.message('Error');
      return console.dir(jqXHR.responseText);
    });
  }
};
