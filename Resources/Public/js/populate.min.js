$.fn.extend({
	populate_liste: function() {
	
		var $this = $(this);

		url = "SUB.Germania/kloster/jsonlist";
		$.getJSON(url, function(response){
			$.each(response, function (key, value) {

				var productArray = value.ortGemeindeKreis;
				var $inputProduct = $("select[name='ort[]']");

				$.each(productArray, function (k, v) {
					$.each(v, function (k1, v1) {
						$inputProduct.append($("<option>", { value: v1, html: k1 }));
					});
				});


				var tr = $this.find('tr:eq(1)').clone(true);
				tr.find('td :input').each( function() {
					var name = $(this).attr('name');
					if ( typeof name === 'undefined' ) return;
					name = name.replace('[]', '');
					var val = response[key][name];
					if ( $(this).is('[type=checkbox]') ) {
						return;
					} else if ( $(this).is('select') ) {
						if(name==="ort"){
							if (val.length > 1) {
								$.each(val, function (ortkey, ortvalue) {
								var selector = '#selectId' + (key+1);
								tr.find("select[name='ort[]'] option").each(function( i, opt ) {
								    if( opt.value == ortvalue ) {
								        $(opt).attr('selected', 'selected');
								    }
								});
								})
							}
							else {
								tr.find("select[name='ort[]'] option").each(function( i, opt ) {
									if( opt.value == val ) {
										$(opt).attr('selected', 'selected');
									}
								});
							}
						}
						else {
							$(this).append('<option>' + val + '</option>');
						}
					} else {
						$(this).val( val );
					}
				});
				$this.append(tr);
				var url= "kloster/edit/" + value.uuid;
				var id = "editLink" + (key + 1);
				$this.find('a#editLink:eq(' + key+1 +')').attr('href', url);
				$this.find('a#editLink:eq(' + key+1 +')').attr('id', id);

			});
			$this.find("textarea").autosize();
		});
		
	
	},
	populate_kloster: function(index, url) {

		var $this = $(this);

//		var url = "kloster/" + url;

		$.getJSON(url, function(response){
			var klosterstandorte = response.klosterstandorte;
			var klosterorden = response.klosterorden;
			var fieldset = $this.find('fieldset:eq(0)');
			fieldset.find('label :input').each( function() {
				var name = $(this).attr('name');
				if ( typeof name === 'undefined' ) return;
				name = name.replace('[]', '');
				var val = response[name];
				if ( $(this).is('[type=checkbox]') ) {
					if (name == "wuestung" && val==1) {
						$(this).prop('checked', true);
					}
					else {
						return;
					}
				} else if ( $(this).is('select') ) {
					$(this).find('option').remove();
						if ( val ) $(this).append('<option>' + val + '</option>');
					} else {
						$(this).val( val );
					}
				});
				$this.find("textarea").autosize();
				$this.find("input[type=url]").keyup();

				$.each(klosterorden, function (key, value) {
					if (key == 0) {
						var fieldset = $this.find('fieldset:eq(2)');
					}
					else {
						var fieldset = $this.find('div.multiple:eq(2)').clone(true);
					}

					fieldset.find('label :input').each( function() {
						var name = $(this).attr('name');
						if ( typeof name === 'undefined' ) return;
						name = name.replace('[]', '');
						var val = value[name];
						if ( $(this).is('[type=checkbox]') ) {
							return;
						} else if ( $(this).is('select') ) {
							$(this).find('option').remove();
							if ( val ) $(this).append('<option>' + val + '</option>');
						} else {
							$(this).val( val );
						}
					});

					if (key > 0) {
						$this.find('div.multiple:eq(2)').append(fieldset);
					}
					$this.find("textarea").autosize();
					$this.find("input[type=url]").keyup();
				})

				$.each(klosterstandorte, function (key, value) {
					if (key == 0) {
						var fieldset = $this.find('fieldset:eq(1)');
					}
					else {
						var fieldset = $this.find('div.multiple:eq(0)').clone(true);
					}

					fieldset.find('label :input').each( function() {
						var name = $(this).attr('name');
						if ( typeof name === 'undefined' ) return;
						name = name.replace('[]', '');
						var val = value[name];
						if ( $(this).is('[type=checkbox]') ) {
							if (name == "wuestung" && val==1) {
								$(this).prop('checked', true);
							}
							else {
								return;
							}
						} else if ( $(this).is('select') ) {
							$(this).find('option').remove();
							if ( val ) $(this).append('<option>' + val + '</option>');
						} else {
							$(this).val( val );
						}
					});

					if (key > 0) {
						$this.find('div.multiple:eq(0)').append(fieldset);
					}
					$this.find("textarea").autosize();
					$this.find("input[type=url]").keyup();
					})
		});
	}
});
